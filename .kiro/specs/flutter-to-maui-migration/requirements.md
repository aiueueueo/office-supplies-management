# 要件ドキュメント

## 概要

この機能は、既存のFlutter出庫端末アプリを.NET MAUIに移行し、直接データベース接続を実現することを目的としています。MAUIアプリはモックアップ・デモンストレーション用途であり、本番環境ではキーエンス端末での運用を予定しています。そのため、ビジネスロジックとUI層を明確に分離し、コア機能を再利用可能なライブラリとして設計します。これにより、異なるプラットフォーム（MAUI、キーエンス端末）で同じビジネスロジックを活用できるアーキテクチャを構築します。

## 要件

### 要件1

**ユーザーストーリー:** 倉庫作業者として、.NET MAUIモバイルアプリケーションを使用して出庫操作を実行したい。統一された技術スタックの恩恵を受けながら、同じワークフローを維持するため。

#### 受入基準

1. アプリケーションが起動した時、システムはデータベースからすべてのアクティブな部署を表示する部署選択画面を表示すること
2. 部署が選択された時、システムはバーコードスキャン画面に遷移すること
3. バーコード/QRコードがスキャンまたは手動入力された時、システムはデータベースから対応する物品情報を取得すること
4. 物品が見つかった時、システムは物品詳細を表示し、出庫数量の入力を可能にすること
5. 出庫数量が入力され確認された時、システムは物品在庫を更新し、データベースに取引記録を作成すること

### 要件2

**ユーザーストーリー:** 倉庫作業者として、デバイスのカメラを使用してバーコード/QRコードをスキャンしたい。出庫操作のために物品を迅速に識別するため。

#### 受入基準

1. バーコードスキャン画面が表示された時、システムはスキャンのためにデバイスカメラを起動すること
2. バーコード/QRコードが検出された時、システムは自動的にスキャンされたコードを処理すること
3. スキャンされたコードがアクティブな物品と一致した時、システムは物品情報を表示すること
4. スキャンされたコードがどの物品とも一致しない時、システムは適切なエラーメッセージを表示すること
5. カメラアクセスが利用できない場合、システムは手動バーコード入力オプションを提供すること

### 要件3

**ユーザーストーリー:** 倉庫作業者として、出庫数量を入力し取引を確認したい。在庫移動を正確に記録するため。

#### 受入基準

1. 物品情報が表示された時、システムは現在の在庫数量を表示し、数量入力を可能にすること
2. 出庫数量が現在の在庫を超える時、システムは警告メッセージを表示すること
3. 有効な数量が入力された時、システムは取引詳細を含む確認画面を表示すること
4. 取引が確認された時、システムは物品のCurrentStockを更新し、Transaction記録を作成すること
5. 取引が完了した時、システムは成功メッセージと別の操作を実行するオプションを表示すること

### 要件4

**ユーザーストーリー:** 倉庫作業者として、エラーを犯した場合に直前の取引をキャンセルしたい。すぐに間違いを修正するため。

#### 受入基準

1. 取引が完了した時、システムは直前の取引をキャンセルするオプションを提供すること
2. キャンセルが要求された時、システムは確認のために直前の取引詳細を表示すること
3. キャンセルが確認された時、システムは在庫変更を元に戻し、取引をキャンセル済みとしてマークすること
4. キャンセルが完了した時、システムは確認を表示し、メイン画面に戻ること
5. 最近の取引が存在しない場合、システムは適切なメッセージを表示すること

### 要件5

**ユーザーストーリー:** システム管理者として、MAUIアプリケーションがSQL Serverデータベースに直接接続することを望む。Web APIエンドポイントへの依存を排除し、アーキテクチャを簡素化するため。

#### 受入基準

1. アプリケーションが起動した時、システムはEntity Framework Coreを使用してSQL Serverデータベースへの直接接続を確立すること
2. データベース操作が実行された時、システムは既存のItem、Department、Transactionエンティティを使用すること
3. 接続問題が発生した時、システムは適切なエラーメッセージと再試行オプションを表示すること
4. オフライン操作が試行された時、システムはデータベース接続が必要であることをユーザーに通知すること
5. データベーススキーマが変更された場合、システムはEntity Frameworkマイグレーションを通じてエンティティ更新を処理すること

### 要件6

**ユーザーストーリー:** 開発者として、既存のEntity Frameworkモデルとデータベーススキーマを再利用したい。現在のシステムアーキテクチャとの一貫性を維持するため。

#### 受入基準

1. MAUIプロジェクトが作成された時、システムは既存のOfficeSupplies.CoreとOfficeSupplies.Infrastructureプロジェクトを参照すること
2. データベース操作が実行された時、システムはWebアプリケーションと同じOfficeSuppliesContextを使用すること
3. データモデルがアクセスされた時、システムは既存のItem、Department、Transactionエンティティを変更なしで使用すること
4. データベースマイグレーションが必要な時、システムは既存のバックエンドと同じマイグレーション戦略を使用すること
5. エンティティ関係がアクセスされる場合、システムはEntity Frameworkナビゲーションプロパティを使用して関連データを適切に読み込むこと

### 要件7

**ユーザーストーリー:** 開発者として、ビジネスロジックをUI層から分離したい。キーエンス端末など異なるプラットフォームで同じ機能を再利用するため。

#### 受入基準

1. ビジネスロジックが実装された時、システムは出庫処理のコア機能を独立したサービスクラスとして提供すること
2. データアクセス層が作成された時、システムはEntity Frameworkを使用したリポジトリパターンを実装すること
3. UI層が実装された時、システムはビジネスロジックに直接依存せず、インターフェースを通じて操作すること
4. 異なるプラットフォームで使用される時、システムは同じビジネスロジックライブラリを参照できること
5. 設定が変更される時、システムは依存性注入を使用してプラットフォーム固有の実装を切り替えられること

### 要件8

**ユーザーストーリー:** 倉庫作業者として、Flutter版と同様の直感的なユーザーインターフェースを持つMAUIアプリケーションを望む。モックアップ・デモンストレーション時に馴染みのあるワークフローを使用するため。

#### 受入基準

1. アプリケーション内を移動する時、システムはFlutter版と同じ画面フロー（ホーム → 部署選択 → バーコードスキャン → 数量入力 → 確認 → 結果）を提供すること
2. 情報を表示する時、システムはモバイルデバイス用の明確で読みやすいフォントと適切な間隔を使用すること
3. エラーが発生した時、システムは推奨アクションを含むユーザーフレンドリーなエラーメッセージを表示すること
4. 操作が成功した時、システムは明確な視覚的フィードバックと確認を提供すること
5. デバイスの向きが変更された場合、システムは縦向きと横向きの両方で使いやすさを維持すること

### 要件9

**ユーザーストーリー:** システム管理者として、将来的にキーエンス端末で同じ機能を使用したい。MAUIで開発したビジネスロジックを再利用するため。

#### 受入基準

1. ビジネスロジックライブラリが作成された時、システムは.NET Standard 2.0以上で実装し、幅広いプラットフォームで使用可能にすること
2. インターフェースが定義された時、システムはバーコードスキャン、データベースアクセス、UI表示の抽象化を提供すること
3. 設定管理が実装された時、システムはプラットフォーム固有の設定を外部から注入できること
4. ログ機能が実装された時、システムはプラットフォームに依存しないログ出力を提供すること
5. エラーハンドリングが実装された時、システムは統一されたエラー処理とレポート機能を提供すること